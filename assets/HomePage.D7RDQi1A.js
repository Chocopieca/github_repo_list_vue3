var Q=Object.defineProperty;var X=(t,e,s)=>e in t?Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var N=(t,e,s)=>X(t,typeof e!="symbol"?e+"":e,s);import{d as ee,r as x,c as T,w as te,a as E,b as g,o as p,e as c,f as se,g as V,n as oe,h as C,t as R,m as J,i as ne,j as re,k as ae,u as b,v as ie,F as G,l as Z,p as $,_ as O,q as I,T as ce,s as D,x as le,y as de,z as ue,A as pe,B as k,C as U,D as me,E as he,G as F}from"./index.gltJaKT-.js";import{u as fe}from"./githubAuth.BIoAxdCB.js";const W=ee("modal",()=>{const t=x([]),e=T(()=>t.value.length>0);te(e,o=>{o?document.body.style.overflow="hidden":document.body.style.overflow=""});function s(o){const i=crypto.randomUUID(),f=1e3+t.value.length,_={...o,id:i,zIndex:f};return t.value.push(_),i}function n(o){const i=t.value.findIndex(f=>f.id===o);i!==-1&&t.value.splice(i,1)}function r(){t.value=[]}return{modals:t,isAnyModalOpen:e,openModal:s,closeModal:n,closeAllModals:r}});var A=(t=>(t.ERROR="error",t.DYNAMIC="dynamic",t.CONFIRMATION="confirmation",t))(A||{});const _e={confirmText:"Confirm",cancelText:"Cancel"};function S(){const t=W();return{showError:(r,o)=>t.openModal({type:A.ERROR,message:r,title:o}),showDynamic:(r,o,i)=>t.openModal({type:A.DYNAMIC,component:r,props:o,title:i}),showConfirmation:(r,o,i={})=>{const{title:f,confirmText:_,cancelText:a,onCancel:l}={..._e,...i};return t.openModal({type:A.CONFIRMATION,message:r,title:f,confirmText:_,cancelText:a,onConfirm:o,onCancel:l})},closeModal:r=>t.closeModal(r),closeAllModals:()=>t.closeAllModals()}}const ge={class:"space-y-3"},ye=E({__name:"UrlDialog",props:{repoUrl:{default:""},ownerUrl:{default:""},modalId:{}},setup(t){const e=t,s=S(),n=()=>{s.closeModal(e.modalId)},r=o=>{window.open(o,"_blank"),n()};return(o,i)=>(p(),g("div",ge,[c("button",{onClick:i[0]||(i[0]=f=>r(o.repoUrl)),class:"w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"}," Repository URL "),c("button",{onClick:i[1]||(i[1]=f=>r(o.ownerUrl)),class:"w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors"}," Owner URL ")]))}}),ve={key:0,class:"mb-3"},we={class:"flex items-center text-sm"},be={class:"font-medium"},Ee={class:"flex items-center text-sm"},Re={class:"font-medium"},xe=E({__name:"RepoCard",props:{repository:{}},setup(t){const e=t,s=S(),n=T(()=>({"p-4 rounded-lg shadow-md mb-4 transition-colors cursor-pointer":!0,"bg-blue-50":!e.repository.has_wiki,"bg-white":e.repository.has_wiki})),r=T(()=>({repoUrl:e.repository.html_url,ownerUrl:e.repository.owner.html_url,title:"Choose URL to open"})),o=()=>{s.showDynamic(J(ye),r.value)},i=T(()=>e.repository.description||"");return(f,_)=>{const a=se("long-press");return V((p(),g("div",{class:oe([n.value,"text-black h-full"])},[_[2]||(_[2]=c("div",{class:"flex justify-between"},null,-1)),i.value?(p(),g("p",ve,R(i.value),1)):C("",!0),c("div",we,[_[0]||(_[0]=c("span",{class:"mr-2"},"Owner:",-1)),c("span",be,R(f.repository.owner.login),1)]),c("div",Ee,[_[1]||(_[1]=c("span",{class:"mr-2"},"Subscribers:",-1)),c("span",Re,R(f.repository.subscribers_count),1)])],2)),[[a,{onLongPress:o,delay:500}]])}}}),Ie=5*60*1e3,q=":",Ae=()=>{const t=x(new Map),e=(a,l)=>l?`${l}${q}${a}`:a,s=a=>Date.now()-a.timestamp>a.ttl;return{set:(a,l,m={})=>{const y=e(a,m.prefix);t.value.set(y,{data:l,timestamp:Date.now(),ttl:m.ttl||Ie})},get:(a,l={})=>{const m=e(a,l.prefix),y=t.value.get(m);return!y||s(y)?(t.value.delete(m),null):y.data},has:(a,l={})=>{const m=e(a,l.prefix),y=t.value.get(m);return!y||s(y)?(t.value.delete(m),!1):!0},remove:(a,l={})=>{t.value.delete(e(a,l.prefix))},removeByPrefix:a=>{const l=`${a}${q}`;for(const m of t.value.keys())m.startsWith(l)&&t.value.delete(m)},clear:()=>t.value.clear(),getCacheKey:(a,l,m)=>{if(!l)return e(a,m);const y=new URLSearchParams(Object.entries(l).map(([K,Y])=>[K,String(Y)])).toString();return e(`${a}${y?`?${y}`:""}`,m)}}};class B extends Error{constructor(e){super(e),this.name=this.constructor.name}}class M extends B{constructor(e,s,n,r){super(e),this.status=s,this.originalError=n,this.details=r}}class H extends B{constructor(){super("Network error occurred")}}class Te extends B{constructor(e){super("An unknown error occurred"),this.originalError=e}}class z extends M{constructor(e,s){super(e,403,s)}}class Ce{static async createError(e){var s;if(e instanceof Response){let n;try{n=await e.json()}catch{n={message:e.statusText}}return e.status===403&&((s=n.message)!=null&&s.includes("API rate limit exceeded"))?new z(n.message,e):new M(n.message||`HTTP Error ${e.status}`,e.status,e,n.details)}return e instanceof TypeError&&e.message==="Failed to fetch"?new H:e instanceof M||e instanceof H||e instanceof z?e:new Te(e)}}const Pe={class:"p-6"},Se={class:"text-black text-xl font-bold mb-4"},Le=E({__name:"GithubAuthModal",props:{title:{}},setup(t){const e=()=>{const s="Ov23liVGFpU5jgw8L93s",n=`${window.location.origin}/auth/callback`,r="repo",o=Math.random().toString(36).substring(7);localStorage.setItem("github_auth_state",o);const i=new URL("https://github.com/login/oauth/authorize");i.searchParams.append("client_id",s),i.searchParams.append("redirect_uri",n),i.searchParams.append("scope",r),i.searchParams.append("state",o),window.location.href=i.toString()};return(s,n)=>(p(),g("div",Pe,[c("h2",Se,R(s.title),1),n[0]||(n[0]=c("p",{class:"text-black mb-6"}," You've reached the GitHub API rate limit. Please authenticate with GitHub to increase your rate limit. ",-1)),c("button",{onClick:e,class:"bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors"}," Authenticate with GitHub ")]))}}),$e=()=>{const t=S(),e=r=>{t.showError(r,"Error")},s=()=>{t.showDynamic(J(Le),{title:"GitHub Authentication Required"})};return{handleError:async r=>{const o=await Ce.createError(r);return o instanceof z?s():o instanceof M?e(`API Error: ${o.message}`):o instanceof H?e("Network Error: Please check your internet connection"):e("An unexpected error occurred. Please try again later"),o},showErrorModal:e}},ke=(t={})=>{const e=x(t.baseURL||""),s=x(t.headers||{}),n=Ae(),r=$e(),o=(d,u)=>{const h=new URL(d,e.value);return u&&Object.entries(u).forEach(([w,v])=>{v!=null&&h.searchParams.append(w,String(v))}),h.toString()},i=(d={})=>{const u={method:d.method||"GET",headers:{"Content-Type":"application/json",...s.value,...d.headers}};return d.body&&(u.body=JSON.stringify(d.body)),u},f=async d=>{if(!d.ok)throw d;return d.json()},_=(d,u={})=>{var h,w;if(((h=u.cache)==null?void 0:h.enabled)!==!1){const v=n.get(d,{prefix:"api",ttl:(w=u.cache)==null?void 0:w.ttl});if(v)return v}return null},a=(d,u,h={})=>{var w,v;((w=h.cache)==null?void 0:w.enabled)!==!1&&n.set(d,u,{prefix:"api",ttl:(v=h.cache)==null?void 0:v.ttl})},l=async(d,u={})=>{try{const h=o(d,u.params),w=i(u),v=await fetch(h,w);return await f(v)}catch(h){throw await r.handleError(h)}};return{get:async(d,u={})=>{const h=n.getCacheKey(d,u.params,"api"),w=_(h,u);if(w)return w;const v=await l(d,{...u,method:"GET"});return a(h,v,u),v},post:async(d,u,h={})=>l(d,{...h,method:"POST",body:u}),put:async(d,u,h={})=>l(d,{...h,method:"PUT",body:u}),delete:async(d,u={})=>l(d,{...u,method:"DELETE"}),baseURL:e,defaultHeaders:s,cache:n,errorHandler:r}};class Ue{constructor(e={}){N(this,"api");this.api=ke(e)}getHeaders(){return{"Content-Type":"application/json",Accept:"application/json"}}}const P={GITHUB_API_URL:"https://api.github.com",DEFAULT_PER_PAGE:10,DEFAULT_ORGANIZATION:"nodejs",GITHUB_TOKEN:""};class Me extends Ue{constructor(s){super({baseURL:s.baseURL});N(this,"authStore",fe())}getHeaders(){const s={...super.getHeaders(),Accept:"application/vnd.github.v3+json"},n=this.authStore.token||P.GITHUB_TOKEN;return n&&(s.Authorization=`Bearer ${n}`),s}async fetchPublicRepositories(s){return(await this.api.get("/search/repositories",{params:{q:`org:${s.organization}`,page:s.page||1,per_page:s.per_page||P.DEFAULT_PER_PAGE,sort:"updated",order:"desc"},headers:this.getHeaders(),cache:{enabled:!0,ttl:3e5}})).items}async fetchRepositorieDitels(s){return await this.api.get(`/repos/nodejs/${s}`,{headers:this.getHeaders(),cache:{enabled:!0,ttl:5*60*1e3}})}}const Oe=()=>new Me({baseURL:P.GITHUB_API_URL}),L={SCROLL:"scrollPosition",REPOS:"repositories",PAGE:"currentPage"},De=100,Ne=100;function Fe(){const t=x([]),e=x(!1),s=x(1),n=x(null),r=Oe(),o=()=>{const a={repositories:t.value,page:s.value,scrollPosition:window.scrollY};Object.entries(a).forEach(([l,m])=>{sessionStorage.setItem(L[l],JSON.stringify(m))})},i=async()=>{const a={repositories:JSON.parse(sessionStorage.getItem(L.REPOS)||"null"),page:parseInt(sessionStorage.getItem(L.PAGE)||"0"),scrollPosition:parseInt(sessionStorage.getItem(L.SCROLL)||"0")};a.repositories&&(t.value=a.repositories,s.value=a.page||1),a.scrollPosition&&(await ae(),setTimeout(()=>{window.scrollTo({top:a.scrollPosition,behavior:"instant"})},Ne))},f=()=>{n.value&&window.clearTimeout(n.value),n.value=window.setTimeout(o,De)},_=async()=>{if(!e.value)try{e.value=!0;const a=await r.fetchPublicRepositories({organization:P.DEFAULT_ORGANIZATION,page:s.value,per_page:P.DEFAULT_PER_PAGE}),l=await Promise.all(a.map(async m=>{const y=await r.fetchRepositorieDitels(m.name);return{...m,subscribers_count:y.subscribers_count}}));t.value.push(...l),s.value++,o()}catch(a){console.error("Failed to load repositories:",a)}finally{e.value=!1}};return ne(async()=>{await i(),t.value.length===0&&_(),window.addEventListener("scroll",f)}),re(()=>{window.removeEventListener("scroll",f),n.value&&window.clearTimeout(n.value)}),{repositories:t,loading:e,loadRepositories:_}}const Ge={class:"repositories-list"},He={key:0,class:"empty-list"},ze={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},Be={key:2,class:"loading-indicator"},je=E({__name:"RepoList",setup(t){const{repositories:e,loading:s,loadRepositories:n}=Fe();return(r,o)=>V((p(),g("div",Ge,[b(e).length===0?(p(),g("div",He,o[0]||(o[0]=[c("span",null,"No repositories found",-1)]))):(p(),g("div",ze,[(p(!0),g(G,null,Z(b(e),i=>(p(),g("div",{key:i.id},[$(xe,{repository:i},null,8,["repository"])]))),128))])),b(s)?(p(),g("div",Be,o[1]||(o[1]=[c("span",null,"Loading more repositories...",-1)]))):C("",!0)])),[[b(ie),{onLoadMore:b(n),disabled:b(s),threshold:200}]])}}),Ke=O(je,[["__scopeId","data-v-7aa33572"]]),Ye={class:"modal-header"},qe={key:0,class:"modal-title"},Ve={class:"modal-content"},Je=E({__name:"BaseModal",props:{id:{},type:{},title:{},zIndex:{}},setup(t){const e=t,s=S(),n=()=>{s.closeModal(e.id)};return(r,o)=>(p(),I(ce,{to:"body"},[$(le,{name:"modal"},{default:D(()=>[e.id?(p(),g("div",{key:0,class:"modal-overlay",style:de({zIndex:e.zIndex}),onClick:n},[c("div",{class:"modal-container",onClick:o[0]||(o[0]=ue(()=>{},["stop"]))},[c("div",Ye,[e.title?(p(),g("h3",qe,R(e.title),1)):C("",!0),c("button",{class:"modal-close",onClick:n},"×")]),c("div",Ve,[pe(r.$slots,"default",{},void 0,!0)])])],4)):C("",!0)]),_:3})]))}}),j=O(Je,[["__scopeId","data-v-31f8d9ff"]]),Ze={class:"error-content"},We={class:"error-message"},Qe=E({__name:"ErrorModal",props:{message:{},type:{},id:{},title:{},zIndex:{}},setup(t){return(e,s)=>(p(),I(j,k(U(e.$props)),{default:D(()=>[c("div",Ze,[s[0]||(s[0]=c("div",{class:"error-icon"},"⚠️",-1)),c("p",We,R(e.message),1)])]),_:1},16))}}),Xe=O(Qe,[["__scopeId","data-v-fab82af3"]]),et={class:"confirmation-content"},tt={class:"confirmation-message"},st={class:"confirmation-actions"},ot=E({__name:"ConfirmationModal",props:{message:{},confirmText:{},cancelText:{},onConfirm:{type:Function},onCancel:{type:Function},type:{},id:{},title:{},zIndex:{}},setup(t){const e=t,s=S(),n=()=>{e.onConfirm(),s.closeModal(e.id)},r=()=>{var o;(o=e.onCancel)==null||o.call(e),s.closeModal(e.id)};return(o,i)=>(p(),I(j,k(U(o.$props)),{default:D(()=>[c("div",et,[c("p",tt,R(o.message),1),c("div",st,[c("button",{class:"btn btn-secondary",onClick:r},R(o.cancelText),1),c("button",{class:"btn btn-primary",onClick:n},R(o.confirmText),1)])])]),_:1},16))}}),nt=O(ot,[["__scopeId","data-v-5f17b7c7"]]),rt=E({__name:"DynamicModal",props:{component:{},props:{},type:{},id:{},title:{},zIndex:{}},setup(t){const e=t,s=T(()=>({id:e.id,type:e.type,title:e.title,zIndex:e.zIndex})),n=T(()=>({...e.props||{},modalId:e.id}));return(r,o)=>(p(),I(j,k(U(s.value)),{default:D(()=>[(p(),I(me(e.component),k(U(n.value)),null,16))]),_:1},16))}}),at=E({__name:"ModalManager",setup(t){const e=W(),{modals:s}=he(e);return(n,r)=>(p(!0),g(G,null,Z(b(s),o=>(p(),g(G,{key:o.id},[o.type===b(A).ERROR?(p(),I(Xe,F({key:0,ref_for:!0},o),null,16)):o.type===b(A).CONFIRMATION?(p(),I(nt,F({key:1,ref_for:!0},o),null,16)):o.type===b(A).DYNAMIC?(p(),I(rt,F({key:2,ref_for:!0},o),null,16)):C("",!0)],64))),128))}}),it={class:"container"},ut=E({__name:"HomePage",setup(t){return(e,s)=>(p(),g("div",it,[s[0]||(s[0]=c("h1",{class:"text-2xl font-bold mb-6"},"Node.js Repositories",-1)),$(Ke),$(at)]))}});export{ut as default};
